- job-template:
    name: '{name}-check'
    defaults: zuul
    builders:
      - shell: |
          set -e
          mkdir build
          jenkins-jobs test jobs/ -o build/
          cp zuul/layout.yaml /tmp
          sudo zuul-server -t -l /tmp/layout.yaml
    triggers:
      - zuul
    node: '{node}'

- job-template:
    name: '{name}-update'
    defaults: zuul
    builders:
      - shell: |
          mkdir build
          rm -Rf /var/lib/jenkins/.cache/jenkins_jobs
          jenkins-jobs test jobs/ -o build/
          jenkins-jobs -l debug --ignore-cache update --delete-old jobs/
          sudo cp zuul/layout.yaml /etc/zuul/
          sudo service zuul reload
    triggers:
      - zuul
    node: '{node}'

- job-template:
    name: '{name}-unit-tests'
    defaults: zuul
    builders:
      - shell: |
          ./run_tests.sh
    triggers:
      - zuul
    node: '{node}'

- job-template:
    name: '{name}-functional-tests'
    defaults: zuul
    builders:
      - shell: |
          ./run_functional-tests.sh
    triggers:
      - zuul
    node: '{node}'

- job-template:
    name: '{name}-sloccount'
    defaults: zuul
    builders:
      - shell: |
          sloccount --duplicates --wide --details . | fgrep -v .svn > sloccount.sc
    triggers:
      - zuul
    node: '{node}'
